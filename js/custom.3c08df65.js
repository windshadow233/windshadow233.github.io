function isFullScreen(){return!!(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.webkitFullScreen||document.msFullScreen)}function fullScreen(){const e=document.body;isFullScreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function setInfo(e,t,n,o){if($(".welcome #local-ip").text(e),$(".welcome #city").text(t),$(".welcome #distance").text(n),!o){var a=new Date;a.setTime(a.getTime()+3e5);var c=JSON.stringify({ip:e,city:t,distance:n});$.cookie("locationInfo",c,{expires:a,path:"/"})}}function getDistance(e,t,n,o){const{sin:a,cos:c,asin:i,PI:r,hypot:s}=Math;let l=(e,t)=>(e*=r/180,{x:c(t*=r/180)*c(e),y:c(t)*a(e),z:a(t)}),d=l(e,t),u=l(n,o),m=2*i(s(d.x-u.x,d.y-u.y,d.z-u.z)/2)*6371;return Math.round(m)}function getIpInfo(){if(void 0!==$(".card-announcement").css("display")&&"none"!==$(".card-announcement").css("display")||!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))if($.cookie("locationInfo")){var e=JSON.parse($.cookie("locationInfo"));setInfo(e.ip,e.city,e.distance,!0)}else $.ajax({type:"get",url:"https://apis.map.qq.com/ws/location/v1/ip",data:{key:"SGYBZ-W6R6C-IHT2B-AH6JO-4DFLZ-IKF3H",output:"jsonp"},dataType:"jsonp",success:function(e){let{result:t={}}=e;if(t&&t.location){let e=getDistance(117.22901,31.82057,t.location.lng,t.location.lat);setInfo(t.ip,t.ad_info.province+t.ad_info.city+t.ad_info.district,e,!1)}}})}function download(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){var o=window.URL.createObjectURL(n.response),a=document.createElement("a");a.style.display="none",a.href=o,a.download=t,a.click(),window.URL.revokeObjectURL(o)},n.send()}function categoryBarRandomColor(){$("#categoryBar").length>0&&$("#categoryBar .category-list-item").each((function(){let e=Math.floor(151*Math.random())+50,t=Math.floor(151*Math.random())+50,n=Math.floor(151*Math.random())+50;$(this).css("background",`rgb(${e},${t},${n})`)}))}function loadAbstract(){let e;if(null!==(match=location.pathname.match(/^\/blog\/(\d+)\/?/))){e=match[1];try{document.querySelector(".st").remove()}catch(e){}var t=new XMLHttpRequest;t.open("GET",`/abstract/${e}?t=${(new Date).getTime()}`),t.send(),t.onreadystatechange=e=>{if(4==t.readyState){if(200==t.status)var n=t.responseText.replace(/<[^>]*>/g,"");else n="文章摘要遇到异常。";const e=document.querySelector("#ai-content"),o=n;!function t(n){if(n<o.length)e.innerHTML+=o[n],setTimeout(t.bind(this),50,++n);else{var a=document.createElement("style");a.className="st",a.innerText="#ai-content::after{content:''!important;}",document.body.appendChild(a)}}(0)}}}}function createCharts(){let e=echarts.init(document.getElementById("posts-chart"),"light");e.setOption(postsOption),e.on("click","series",(e=>{"series"===e.componentType&&pjax.loadUrl("/archives/"+e.name.replace("-","/"))})),window.addEventListener("resize",(()=>{e.resize()})),tagsChart=echarts.init(document.getElementById("tags-chart"),"light"),tagsChart.setOption(tagsOption),tagsChart.on("click",(e=>{e.name&&pjax.loadUrl("/tags/"+e.name.toLowerCase())})),window.addEventListener("resize",(()=>{tagsChart.resize()})),categoriesChart=echarts.init(document.getElementById("categories-chart"),"light"),categoriesChart.setOption(categoriesOption),categoriesChart.on("click","series",(e=>{e.data.path&&pjax.loadUrl("/"+e.data.path)})),window.addEventListener("resize",(()=>{categoriesChart.resize()}))}$(document).on("pjax:complete",(function(e){void 0!==window.a2a&&a2a.init_all(),getIpInfo()})),$(document).on("pjax:error",(function(e){Snackbar.show({text:"似乎出了点问题，不妨刷新网页试试？",pos:"top-right",showAction:!1})})),$(document).on("click","a[download]",(function(e){e.preventDefault();download($(this).attr("href"),$(this).attr("download"))})),$(document).on("click",".DocSearch-Hit a",(function(e){e.preventDefault();var t=$(this).attr("href");pjax.loadUrl(t)})),$(document).ready((function(){getIpInfo()}));